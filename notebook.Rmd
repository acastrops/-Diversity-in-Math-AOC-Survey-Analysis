---
title: "Does the gender and ethnicity of New College students influence their experience with math classes?"
author: "Adriana Souza, Lydia Laseur, Roger Filmyer"
date: "November 12th, 2017"
output:
  html_notebook:
    highlight: tango
    mathjax: null
    number_sections: yes
    theme: spacelab
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
# Loading packages we will be using
library(survey)
library(srvyr)
library(psych)
library(shiny)
library(dplyr)
library(ggplot2)
library(tibble)
library(reshape2)
library(tidyr)
library(stringi)
library(likert)
```


# Overview and motivation

This is a report created for Professor Chris Kottke's survey. Goals of the survey were to get more information about the students in order to address the lack of gender diversity in the math AOC. Dr. Kottke wanted to get a sense of how the students feel and test the incidence of things like belonging uncertainty, impostor syndrome, and stereotype threat at New College of Florida.

The questions had the following goals: 

(1) Gauging interest in mathematics
(2) Measuring belonging uncertainty
(3) Measuring confidence levels
(4) Stereotype threat

Conditioned on the self-reported gender and ethinicity.

## Survey information

The population consists of New College students exclusively, given that only respondents with an *@ncf.edu* email address were allowed to reply. 

+ New College has 861 students (as of Fall 2016) and the survey had a total of 264 responses which are all complete.

+ Responders: 60% female, 28.3% male, 11.7% non-binary.

+ The data was de-identified for the purpose of this study so no IRB approval was required. 

## Data

Likert-type responses were chosen due to being a popular psychometric item scoring scheme when trying to quantify peopleâ€™s opinions on different issues. 

The problem with Likert-type scales and ordinal responses is how to choose the appropriate statistical treatment of the data. If the data is ordinal, then non-parametric statistics are typically considered the most appropriate option for analysis. If the data is interval, then parametric statistics can be used. 

To avoid possible misinterpretation, we took care in analyzing how each variable and question were coded. Additionally, each question has corresponding visualizations that illustrate the relationships more clearly. 

### Issues

Likert scales may be subject to distortion from several causes. 

First, Likert scales are arbitrary; the value assigned to an item has no objective numerical basis, either in terms of measure theory or scale (from which a distance metric can be determined). The value assigned to each Likert item is determined by who designed the survey.

The second major problem is whether the "distance" between each Likert item is equivalent. A good Likert scale will present a symmetry of categories about a midpoint with clearly defined linguistic qualifiers.

- **Non-response bias**

The phenomenon that the required information is not obtained from the people selected in the sample.

- **Social Desirability and acquiescence bias**

Respondents may avoid using extreme response categories out of a desire of being perceived as having extremist views

Agree with statements as presented ...


- **Sample size and power** 
The probability of not getting false positives is affected by three factors:

+ **Sample size (n)** The greater the sample size, the greater the power.  In our case, Other things being equal, the number of responses (264) represents 31% of currently enrolled students at New College. 

+ **Significance level ($\alpha$)** The higher the significance level, the higher the power of the test. Increasing the significance level reduces the region of acceptance. As a result, we are more likely to reject the null hypothesis; i.e., we are less likely to accept the null hypothesis when it is false, or making a Type II error. This increases the statistical power of the test.

+ **The "true" value of the parameter being tested** The greater the difference between the "true" value of a parameter and the value specified in the null hypothesis, the greater the power of the test. That is, the greater the effect size, the greater the power of the test.

### Corrections

- Using weighted averages:

- Design questions with students' sensitivity in mind; e.g. asking directly what their assessment of their own levels of confidence may not yield usable data due to issues mentioned above

- Having a scale design with balanced keying (an equal number of positive and negative statements regarding each position or issue in question) can mitigate the random error caused by acquiescence bias. Defensive, central tendency, and social desirability biases are somewhat more problematic and were not explicitly addressed in this analysis.

- Lastly, using sliders instead of the typical five-level format would yielf a continuous response variable which would expand the number of tests that could be used for analysis.

# Analysis

+ Non-parametric rank-based inference such as the median, the Mann-Whitney U test, or the Kruskal Wallis test. 

+ But if we have a well-defined likert scale, we might still be able to get useful results with standard statistical summaries and inference as well (though Melissa is not sure whether the assumptions for standard linear regression would be met).

+  It could be interesting for your project to try (for example) to see what you find when you compare the means of two groups vs the medians of two groups. Or what do you find if you do a t-test vs a MW test? etc.


## Cleaning up data

```{r read_data}
## Reading data in
raw_data <- read.csv("survey_responses.csv",nrows = 264)
```



```{r create_dictionary}
## Reassigning column names, and creating dictionary for new column names
num_questions <- ncol(raw_data)
questions <- data.frame(colnames(raw_data))
new_col_names <- paste("Q",as.character(c(1:num_questions)),sep = "")
colnames(raw_data) <- new_col_names
data_dictionary <- data.frame(cbind(questions,new_col_names))

## Save raw data with new column names to "data" which will be normalized
data <- raw_data 
```



```{r normalizing_gender}
## Normalize gender column into binary data based on whether the responder reported their gender as "Male"
gender_col <- as.character(data$Q1)
non_male <- gender_col != "Male"
gender_col[non_male] <-  "Not Male"
gender_col <- as.factor(gender_col)
data$Q1 <- gender_col
```



```{r normalizing_ethnicity}
ethnicity <- data.frame(data$Q2)
colnames(ethnicity) <- c("ethnicity_list")

ethnicity[ethnicity$ethnicity_list %in% c("Arab", "Middle Eastern"), ] <- "White"
ethnicity[ethnicity$ethnicity_list == "Black or African American, Hispanic or Latino, Multi-Racial", ] <- "Black or African American, Hispanic or Latino"
ethnicity[ethnicity$ethnicity_list == "Mixed, Jamaican/Itailian/Chinese", ] <- "Asian, Black or African American, White"
ethnicity[ethnicity$ethnicity_list %in% c("Alien", "I do not wish to declare my race/ethnicity", ""), ] <- NA
ethnicity$ethnicity_list <- droplevels(ethnicity$ethnicity_list)

## Get the right ethnic groups
ethnicity_groups <- levels(ethnicity$ethnicity_list) %>% strsplit(", ") %>% unlist %>% unique
ethnicity_groups <- ethnicity_groups[!grepl(",", ethnicity_groups)]

## Recast the ethnicity table with the comma-separated list into a new table
ethnicity <- ethnicity %>%
  rowid_to_column("id") %>%
  mutate(ethnic_group = strsplit(as.character(ethnicity_list), ", ")) %>%
  unnest() %>%
  dcast(id ~ ethnic_group)

## We get "White" and NA in the white column, for example
ethnicity[, -1] <- !is.na(ethnicity)[,-1]

## 2 new columns, non-hispanic white and only white or asian
ethnicity$"Non-Hispanic White" <- !(rowSums(ethnicity[, c("Asian", "Black or African American", "Hispanic or Latino", "Native Hawaiian or Other Pacific Islander", "NA")]) > 0)
ethnicity$"Only White or Asian" <- !(rowSums(ethnicity[, c("Black or African American", "Hispanic or Latino", "Native Hawaiian or Other Pacific Islander", "NA")]) > 0)

data <- cbind(data, ethnicity[, -1])
```



```{r normalizing_aoc}
stem_search_criteria <- c("bio", "comp sci", "compsci", "computer", "data", "natsci", "nat sci", "natural sci", "math", "chem",
                          # The fun ones:
                          "Marine Science", "Conputer Science")
data$is_stem_aoc <- stri_detect_regex(data$Q4, paste(stem_search_criteria, collapse='|'), case_insensitive=TRUE)
```



```{r to_three_groups}
to_three_averages <- function(fctr){
  levels(fctr) <- c("Above average", "Average", "Below average", "Above average", "Below average")
  return(fctr)
}

to_three_agrees <- function(fctr){
  levels(fctr) <- c("Agree", "Disagree", "Neutral", "Agree", "Disagree")
  return(fctr)
}
```

## Contingency tables and test of association

## Goodness of Fit 

For the comparison of two groups on an ordinal response, 


Instead of testing independence or conditional independece we can also test the fit of a model that would compare 

## Logistic Regression

# Results


```{r crosstab_socialgroup_example, eval=FALSE}
gender_vs_social_group_perception <- table(data$Q1, data$Q17)
gender_vs_social_group_perception
```

```{r crosstab_socialgroup_3groups}
gender_vs_social_group_perception <- table(data$Q1, to_three_averages(data$Q17))
gender_vs_social_group_perception
chisq.test(gender_vs_social_group_perception)
```

# Appendix

## Appendix: Question breakdown


## Question breakdown
### Question 1: What gender do you identify as?
```{r}
other <- (raw_data$Q1 != "Male" & raw_data$Q1 != "Female")
gender <- as.character(raw_data$Q1)
gender[other] <- "Other"
gender <- data.frame((as.factor(gender)))
colnames(gender) <- "options"
ggplot(gender,aes(options)) + geom_bar()
```

## Question 2: What is your race/ethnicity?
```{r}
library(cluster)
library(reshape2)
race_ethnicity <- sapply(data[,ethnicity_groups],as.integer)

multiethnic <- rowSums(race_ethnicity) > 1

race_ethnicity <- race_ethnicity[!multiethnic,]

race_ethnicity_counts <- data.frame(colSums(race_ethnicity))
colnames(race_ethnicity_counts) <- "Frequency" 
race_ethnicity_counts <- rbind(race_ethnicity_counts, sum(multiethnic))
rownames(race_ethnicity_counts)[6] <- "Multiethnic"
```

## Question 3: What is your year at New College?
```{r}
year <- ggplot(data, aes(Q3))
year + geom_bar()
```

## Question 4: What is your Area of Concentration?

## Question 5: Which math classes have you taken at New College?

## Question 6: Are you considering, or did you ever consider a concentration in Math?
```{r}
q6 <- ggplot(data, aes(Q6,fill = factor(Q1))) 
q6 + geom_bar()

```

## Question 7: Are you interested in graduate school, in any discipline?
```{r}
q7 <- ggplot(data, aes(Q7,fill = factor(Q1))) 
q7 + geom_bar()
```

### Question 8: "I find mathematics interesting."
```{r}
l <- likert(data.frame(data$Q8),grouping=data$Q1)
likert.bar.plot(l)

levels(data$Q8)
data$Q8 <-  factor(data$Q8,levels(data$Q8)[c(5,2,3,1,4)])


q8 <- ggplot(data, aes(Q8,fill = factor(Q1))) 
q8 + geom_bar(position="fill") 
```
### Question 9: "Mathematics leads to many possible career opportunities."
```{r}
levels(data$Q9)
data$Q9 <-  factor(data$Q9,levels(data$Q9)[c(2,3,1,4)])


q9 <- ggplot(data, aes(Q9,fill = factor(Q1))) 
q9 + geom_bar(position="fill")
```

